<% unless notice.nil? %>
    <p id="notice" class="alert alert-dismissible alert-success"><%= notice %></p>
<% end %>
<script>
    $('#issues').addClass("active")
</script>

<h4 style="color: orange">Список нарушений</h4>

<%= link_to 'Новое нарушение', new_issue_path, :class => 'btn btn-success btn-sm' %>
<br>
<br>
<form class="form-inline" method="get">

    <div class="form-group" style="position: relative">
        <label>С</label>
        <input value="<%= (@from).strftime("%d.%m.%Y") %>" class="form-control input date input-sm" type="text" id="from" name="from">
    </div>

    <div class="form-group" style="position: relative">
        <label>По</label>
        <input value="<%= (@to).strftime("%d.%m.%Y") %>" class="form-control input date input-sm" type="text" id="to" name="to">
    </div>

    <input type="submit" value="Выбрать" class="btn btn-primary btn-sm">

</form>
<br>
<style>
    table tr td {
        padding: 0px;
    }
</style>
<table class="table table-striped table-hover">
    <tr class="row"></tr>
    <th>№</th>
    <th>Выявил</th>
    <th>Дата проверки</th>
    <th>Нарушитель</th>
    <th>Статус</th>
    <th>Нарушение</th>
    <th>Отвественный</th>
    <th>Дата</th>
    <th>Рабочее место</th>
    <th>Принятые оперативные меры</th>
    <th >Действия</th>

    </tr>

    <% @issues.each do |issue| %>
        <% cache(issue) do %>
            <tr
                <% unless issue.work_space.is_active? %>
                class="warning" title="Рабочее место не задействовано. В кресте не будет отображаться"
                <% end %>

                <% if issue.issue_type.nil? %>
                class="danger" title="Не задан вид нарушения"
                <% end %>
                >
                <td class="col-md-1" style="width: 20px"><%= issue.id %></td>
                <td class="col-md-2"><%= issue.author.full_name %></td>
                <td class="col-md-1"><%= (issue.created_at.to_date).strftime('%d.%m.%Y') %></td>
                <td class="col-md-1"><%= issue.violator.full_name %></td>
                <td class="col-md-1"><%= issue.status.name %></td>
                <td class="col-md-2"><%= issue.issue_type.name unless issue.issue_type.nil? %><%= "(#{issue.clarification})" unless issue.clarification.empty? %></td>
                <td class="col-md-2"><%= issue.assigned.full_name %></td>
                <td class="col-md-1">
                    <% if issue.due_date.nil? %>
                        &nbsp;
                    <% else %>
                        <%= (issue.due_date).strftime('%d.%m.%Y') unless issue.due_date.nil? %>
                    <% end %>
                </td>

                <td class="col-md-2">
                    <% if issue.work_space.nil? %>
                        &nbsp;
                    <% else %>
                        <%= issue.work_space.name %>
                    <% end %>
                </td>
                <td class="col-md-2"><%= issue.note_measures %></td>
                <td class="col-md-1">
                    <%= link_to '', edit_issue_path(issue), {:class => 'btn glyphicon glyphicon-edit btn-primary  btn-sm '} %>
                    <!--
                <%= link_to('Удалить', issue, method: :delete, data: {confirm: 'Are you sure?'}, :class => 'btn btn-danger btn-sm ') %>
                -->
                </td>
            </tr>
        <% end %>
    <% end %>

</table>
<%= paginate @issues %>

<script>
    $(function () {
        $('.form-group #from').datetimepicker({
            locale: 'ru',
            showTodayButton: true,
            format: 'DD.MM.YYYY'
        });
        $('.form-group #to').datetimepicker({
            locale: 'ru',
            showTodayButton: true,
            format: 'DD.MM.YYYY'
        });
    });
</script>

<br>


